---
title: 'R Tutorial: Precipitation Graphs, Pt 2'
author: "Nathan Byers"
date: "Monday, July 17, 2014"
output:
  html_document:
    theme: readable
---

In <a href="http://rpubs.com/NateByers/precipRidem" target="_blank">part 1</a>
of this tutorial we tidied up some data from the `IDEMdata` package. In
this part of the tutorial we will use that data to create precipitation graphs. 
And in part 3 we will use functions and loops to automate the creation of these
graphs. 

# The data


We will be using the `wide.precip.df` data frame to create the precipitation
graphs. See <a href="http://rpubs.com/NateByers/precipRidem" target="_blank">part 1</a>
for instructions on how to obtain that data frame.

```{r, echo=FALSE}
load("wide_precip_df.rdata")
```

# The graphs

For the graphs, we will first use the base `barplot()` function to display 
precipitation levels over time, with the chemistry sampling values overlayed as
points. Then we will use `ggplot2` to display the same data in alternative ways.

## Base graphics

For the base graphics plot, we first display the precipitation data as a bar plot. 
We also save the plot as a variable to retain information about its dimensions.

```{r, eval=FALSE}
op <- par(mar=c(5, 4, 4, 6) + 0.1)
precip <- unique(wide.precip.df[, c("date", "precipitation")])
b.plot <- barplot(height = precip$precipitation, names.arg = precip$date,
                  xlab="Date", ylab="Precipitation (in)", 
                  ylim=c(0,5))
```

```{r, echo=TRUE}
op <- par(mar=c(5, 4, 4, 6) + 0.1)
precip <- unique(wide.precip.df[, c("date", "precipitation")])
b.plot <- barplot(height = precip$precipitation, names.arg = precip$date,
                  xlab="Date", ylab="Precipitation (in)", 
                  ylim=c(0,5))
par(op)
```

We will be using this plot as a back drop for plotting the watershed sampling
data as points. The first plot will be percent saturation for station LMG-05-0009.

```{r}
station.1 <- wide.precip.df[wide.precip.df$station == "LMG-05-0009" &
                              !is.na(wide.precip.df$station), ]
```

In order to add points to a bar plot, we'll use the x locations that are found
in the `b.plot` variable. 

```{r, eval=FALSE}
b.plot <- barplot(height = precip$precipitation, names.arg = precip$date,
                  xlab="Date", ylab="Precipitation (in)", 
                  ylim=c(0,5))
bar.x <- b.plot[station.1$jday]

par(new = TRUE)
plot(x = bar.x, y = station.1$sat, xlab = "", ylab = "", pch = 16,
     ylim = c(0, 3*max(station.1$sat, na.rm = TRUE)), axes = FALSE, col = "red")
axis(4, col = "red", col.axis = "red", 
     ylim = c(0, 3*max(station.1$sat, na.rm = TRUE)))
mtext("% Saturation", side = 4, line=3, cex = par("cex.lab"), col = "red")
title(main="Site 1")
par(op)  # reset graphing parameters
```

```{r, echo=FALSE}
op <- par(mar=c(5, 4, 4, 6) + 0.1)
b.plot <- barplot(height = precip$precipitation, names.arg = precip$date,
                  xlab="Date", ylab="Precipitation (in)", 
                  ylim=c(0,5))
bar.x <- b.plot[station.1$jday]

par(new = TRUE)
plot(x = bar.x, y = station.1$sat, xlab = "", ylab = "", pch = 16,
     ylim = c(0, 3*max(station.1$sat, na.rm = TRUE)), axes = FALSE, col = "red")
axis(4, col = "red", col.axis = "red", 
     ylim = c(0, 3*max(station.1$sat, na.rm = TRUE)))
mtext("% Saturation", side = 4, line=3, cex = par("cex.lab"), col = "red")
title(main="Site 1")

```

Finally, we add a legend.

```{r, eval=FALSE}
legend("topright", # places a legend at the appropriate place 
       legend = c("Precip","% Sat"), # puts text in the legend 
       lty=c(1, 0), pch = c(NA, 19), # gives the legend appropriate symbols 
       col=c("black","red")) # appropriate colors
par(op)  # reset graphing parameters

```

```{r, echo=FALSE}
op <- par(mar=c(5, 4, 4, 6) + 0.1)
b.plot <- barplot(height = precip$precipitation, names.arg = precip$date,
                  xlab="Date", ylab="Precipitation (in)", 
                  ylim=c(0,5))
bar.x <- b.plot[station.1$jday]

par(new = TRUE)
plot(x = bar.x, y = station.1$sat, xlab = "", ylab = "", pch = 16,
     ylim = c(0, 3*max(station.1$sat, na.rm = TRUE)), axes = FALSE, col = "red")
axis(4, col = "red", col.axis = "red", 
     ylim = c(0, 3*max(station.1$sat, na.rm = TRUE)))
mtext("% Saturation", side = 4, line=3, cex = par("cex.lab"), col = "red")
title(main="Site 1")

legend("topright", # places a legend at the appropriate place 
       legend = c("Precip","% Sat"), # puts text in the legend 
       lty=c(1, 0), pch = c(NA, 19), # gives the legend appropriate symbols
       col=c("black","red")) # appropriate colors
par(op)  # reset graphing parameters
```


Now we'll make another graph, this time using E. coli data.

```{r}
op <- par(mar=c(5, 4, 4, 6) + 0.1)
b.plot <- barplot(height = precip$precipitation, names.arg = precip$date,
                  xlab="Date", ylab="Precipitation (in)", 
                  ylim=c(0,5))
bar.x <- b.plot[station.1$jday]

par(new = TRUE)
plot(x = bar.x, y = station.1$e_coli, xlab = "", ylab = "", pch = 16,
     ylim = c(0, 3*max(station.1$e_coli, na.rm = TRUE)), axes = FALSE, col = "red")
axis(4, col = "red", col.axis = "red", 
     ylim = c(0, 3*max(station.1$e_coli, na.rm = TRUE)))
abline(h=125, lty=2, col="red")
mtext("E. coli (MPN/100mL)", side = 4, line=3, cex = par("cex.lab"), col = "red")
title(main="Site 1")

legend("topright", # places a legend at the appropriate place 
       legend = c("Precip","E. coli", "WQS"), # puts text in the legend 
       lty=c(1, 0, 2), pch = c(NA, 19, NA), # gives the legend appropriate symbols 
       col=c("black","red", "red")) # appropriate colors
par(op)  # reset graphing parameters
```



## ggplot2



...
-------------------------------------------------------------------------------


### R Markdown

This tutorial was created using RStudio's <a href="http://rmarkdown.rstudio.com/"
target="_blank">R Markdown</a>. The code can be found on <a href="https://github.com/NateByers/precip2Ridem"
target="_blank">GitHub</a>.